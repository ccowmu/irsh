#!/usr/bin/fish

# If we have arguments, behave like the lower script: print them and pipe onward.
# Otherwise, just read stdin.
if set -q argv[1]
    printf "%s" "$argv"
else
    cat
end | begin
    # Slurp everything into a single string, preserving newlines (including trailing)
    set text (string collect -N)

    set out ""
    set count 1

    # Walk character by character
    for char in (string split '' -- $text)
        # Work from a lowercase version of the character
        set lower (string lower -- $char)

        # Only letters participate in the alternating pattern
        if string match -rq '[a-z]' -- $lower
            if test (math "$count % 2") -eq 0
                # even: upper
                set out "$out"(string upper -- $lower)
            else
                # odd: lower
                set out "$out$lower"
            end
            set count (math "$count + 1")
        else
            # Non-letters are passed through unchanged and don't affect the count
            set out "$out$char"
        end
    end

    printf "%s" "$out"
end
